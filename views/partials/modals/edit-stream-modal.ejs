<!-- Edit Stream Modal -->
<div id="editStreamModal" class="fixed inset-0 bg-black/50 z-50 hidden modal-overlay flex items-center justify-center p-2 md:p-4">
  <div class="bg-dark-800 rounded-lg shadow-xl w-full max-w-2xl modal-container max-h-[95vh] md:max-h-[92vh] flex flex-col relative">
    
    <!-- Header -->
    <%- include('stream-modal-header', {
      title: 'Edit Stream',
      showSaveTemplate: true,
      saveTemplateFunction: 'saveEditAsTemplate',
      showImport: false,
      closeFunction: 'closeEditStreamModal'
    }) %>
    
    <!-- Tabs -->
    <%- include('stream-modal-tabs', {
      tabPrefix: 'editTab'
    }) %>
    
    <!-- Form Content -->
    <div class="flex-1 overflow-y-auto">
      <form id="editStreamForm" class="px-4 pt-3 pb-3 space-y-3" novalidate>
        <input type="hidden" id="editStreamId" name="streamId" value="">
        <input type="hidden" id="editSelectedVideoId" name="videoId" value="">
        
        <div class="space-y-3">
          <!-- Video Selector -->
          <%- include('stream-modal-video-selector', {
            videoIdField: 'editSelectedVideoId',
            selectedVideoField: 'editSelectedVideo',
            dropdownId: 'editVideoSelectorDropdown',
            searchInputId: 'editVideoSearchInput',
            listContainerId: 'editVideoListContainer'
          }) %>
          
          <!-- Stream Title -->
          <%- include('stream-modal-title', {
            titleFieldId: 'editStreamTitle',
            titleFieldName: 'streamTitle'
          }) %>
          
          <!-- YouTube API Fields (Edit version - needs separate component with edit IDs) -->
          <div id="youtubeApiFields" class="hidden space-y-3">
            <div>
              <label class="text-sm font-medium text-white block mb-2">Description</label>
              <textarea name="youtubeDescription" id="editYoutubeDescription" rows="3"
                class="w-full px-4 py-2.5 bg-dark-700 border border-gray-600 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary"
                placeholder="Stream description (optional)"></textarea>
            </div>
            
            <label class="text-sm font-medium text-white block mb-1.5">Stream Configuration</label>
            <div class="space-y-2">
              <div class="relative">
                <input type="text" id="editYoutubeRtmpUrl"
                  class="w-full pl-10 pr-12 py-2.5 bg-dark-700 border border-gray-600 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary"
                  placeholder="RTMP URL">
                <i class="ti ti-link absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <button type="button" id="editYoutubePlatformSelector"
                  class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full hover:bg-dark-600 transition-colors"
                  aria-label="Select platform">
                  <i class="ti ti-list-check text-gray-400 hover:text-primary"></i>
                </button>
                <div id="editYoutubePlatformDropdown"
                  class="hidden absolute z-10 right-0 mt-1 w-48 bg-dark-700 rounded-lg border border-gray-600 shadow-lg overflow-hidden">
                  <div class="py-1">
                    <button type="button" class="youtube-platform-option w-full flex items-center px-4 py-2 hover:bg-dark-600" data-url="rtmps://a.rtmp.youtube.com/live2">
                      <i class="ti ti-brand-youtube text-red-500 text-base mr-2"></i>
                      <span class="text-sm">YouTube</span>
                    </button>
                    <button type="button" class="youtube-platform-option w-full flex items-center px-4 py-2 hover:bg-dark-600" data-url="rtmps://b.rtmp.youtube.com/live2?backup=1">
                      <i class="ti ti-brand-youtube text-red-400 text-base mr-2"></i>
                      <span class="text-sm">YouTube (Backup)</span>
                    </button>
                    <button type="button" class="youtube-platform-option w-full flex items-center px-4 py-2 hover:bg-dark-600" data-url="rtmps://live-api-s.facebook.com:443/rtmp">
                      <i class="ti ti-brand-facebook text-blue-500 text-base mr-2"></i>
                      <span class="text-sm">Facebook</span>
                    </button>
                    <button type="button" class="youtube-platform-option w-full flex items-center px-4 py-2 hover:bg-dark-600" data-url="rtmps://ingest.global.live.prod.tiktok.com/live">
                      <i class="ti ti-brand-tiktok text-black text-base mr-2"></i>
                      <span class="text-sm">TikTok</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div>
              <label class="text-sm font-medium text-white block mb-2">Stream Key</label>
              <div class="relative">
                <input type="password" id="editYoutubeStreamKey"
                  class="w-full px-4 py-2.5 pl-10 pr-12 bg-dark-700 border border-gray-600 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary font-mono text-sm"
                  placeholder="Stream key">
                <input type="hidden" id="editYoutubeStreamId" value="">
                <i class="ti ti-key text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"></i>
                <button type="button" onclick="toggleEditYouTubeStreamKeyVisibility()"
                  class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors">
                  <i class="ti ti-eye" id="editYoutubeStreamKeyToggle"></i>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Manual RTMP Fields -->
          <%- include('stream-modal-manual-rtmp', {
            rtmpUrlId: 'editRtmpUrl',
            streamKeyId: 'editStreamKey',
            platformSelectorId: 'editPlatformSelector',
            platformDropdownId: 'editPlatformDropdown',
            streamKeyToggleId: 'editStreamKeyToggle',
            streamKeysDropdownId: 'editManualRTMPStreamKeysDropdown',
            streamKeysListId: 'editManualRTMPStreamKeysList',
            streamKeysCountId: 'editManualStreamKeysCount',
            streamKeysCacheInfoId: 'editManualStreamKeysCacheInfo'
          }) %>
          
          <!-- Schedule Settings -->
          <%- include('stream-modal-schedule', {
            scheduleSlotsContainerId: 'editScheduleSlotsContainer',
            loopVideoId: 'editLoopVideo',
            addSlotFunction: 'addEditScheduleSlot',
            serverTimeDisplayId: 'editServerTimeDisplay'
          }) %>
        </div>
      </form>
    </div>
    
    <!-- Footer -->
    <%- include('stream-modal-footer', {
      formId: 'editStreamForm',
      cancelFunction: 'closeEditStreamModal',
      submitButtonText: 'Update Stream'
    }) %>
  </div>
</div>
